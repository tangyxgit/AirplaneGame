var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o]);i.prototype=e.prototype,t.prototype=new i},__awaiter=this&&this.__awaiter||function(t,e,i,o){return new(i||(i=Promise))(function(r,n){function s(t){try{h(o.next(t))}catch(e){n(e)}}function a(t){try{h(o["throw"](t))}catch(e){n(e)}}function h(t){t.done?r(t.value):new i(function(e){e(t.value)}).then(s,a)}h((o=o.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){function i(t){return function(e){return o([t,e])}}function o(i){if(r)throw new TypeError("Generator is already executing.");for(;h;)try{if(r=1,n&&(s=n[2&i[0]?"return":i[0]?"throw":"next"])&&!(s=s.call(n,i[1])).done)return s;switch(n=0,s&&(i=[0,s.value]),i[0]){case 0:case 1:s=i;break;case 4:return h.label++,{value:i[1],done:!1};case 5:h.label++,n=i[1],i=[0];continue;case 7:i=h.ops.pop(),h.trys.pop();continue;default:if(s=h.trys,!(s=s.length>0&&s[s.length-1])&&(6===i[0]||2===i[0])){h=0;continue}if(3===i[0]&&(!s||i[1]>s[0]&&i[1]<s[3])){h.label=i[1];break}if(6===i[0]&&h.label<s[1]){h.label=s[1],s=i;break}if(s&&h.label<s[2]){h.label=s[2],h.ops.push(i);break}s[2]&&h.ops.pop(),h.trys.pop();continue}i=e.call(t,h)}catch(o){i=[6,o],n=0}finally{r=s=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}var r,n,s,a,h={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return a={next:i(0),"throw":i(1),"return":i(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a},Level=function(){function t(e){this.layour=e,t.GAME_STATE=t.GAME_READY}return t.prototype.startGame=function(){t.GAME_STATE=t.GAME_ING},t.prototype.pauseGame=function(){t.GAME_STATE=t.GAME_PAUSE},t.prototype.restartGame=function(){},t.prototype.endGame=function(){t.GAME_STATE=t.GAME_END,this.layour.removeChildren()},t.prototype.addChild=function(t){this.layour.addChild(t)},t.prototype.addChildAt=function(t,e){this.layour.addChildAt(t,e)},t.prototype.getContext=function(){return this.layour},t.GAME_READY=1,t.GAME_ING=2,t.GAME_PAUSE=3,t.GAME_END=4,t}();__reflect(Level.prototype,"Level");var Role=function(t){function e(){var e=t.call(this)||this;return e.mStageW=0,e.mStageH=0,e.mBlood=0,e.addEventListener(egret.Event.ADDED_TO_STAGE,e.createAirplane,e),e}return __extends(e,t),e.prototype.createAirplane=function(){this.mStageW=this.stage.stageWidth,this.mStageH=this.stage.stageHeight},e.prototype.checkCollosion=function(t,e,i){return!1},e.prototype.updateBlood=function(){},e.prototype.setBlood=function(t){0>=t&&(t=0),this.mBlood=t},e.prototype.getBlood=function(){return this.mBlood},e.prototype.getStageW=function(){return this.mStageW},e.prototype.getStageH=function(){return this.mStageH},e.prototype.getX=function(){return 0},e.prototype.getY=function(){return 0},e.prototype.getWidth=function(){return 0},e.prototype.getHeight=function(){return 0},e}(egret.DisplayObjectContainer);__reflect(Role.prototype,"Role");var Main=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),egret.lifecycle.addLifecycleListener(function(t){}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()};var e=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",e),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.runGame()["catch"](function(t){console.log(t)})},e.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(i){switch(i.label){case 0:return[4,this.loadResource()];case 1:return i.sent(),this.createGameScene(),[4,RES.getResAsync("description_json")];case 2:return t=i.sent(),[4,platform.login()];case 3:return i.sent(),[4,platform.getUserInfo()];case 4:return e=i.sent(),console.log(e),[2]}})})},e.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(i){switch(i.label){case 0:return i.trys.push([0,4,,5]),t=new LoadingUI,this.stage.addChild(t),[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return i.sent(),[4,this.loadTheme()];case 2:return i.sent(),[4,RES.loadGroup("preload",0,t)];case 3:return i.sent(),this.stage.removeChild(t),[3,5];case 4:return e=i.sent(),console.error(e),[3,5];case 5:return[2]}})})},e.prototype.loadTheme=function(){var t=this;return new Promise(function(e,i){var o=new eui.Theme("resource/default.thm.json",t.stage);o.addEventListener(eui.UIEvent.COMPLETE,function(){e()},t)})},e.prototype.createGameScene=function(){var t=new TheFirstPass(this);t.startGame()},e}(eui.UILayer);__reflect(Main.prototype,"Main");var DebugPlatform=function(){function t(){}return t.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,{nickName:"username"}]})})},t.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);var ThemeAdapter=function(){function t(){}return t.prototype.getTheme=function(t,e,i,o){function r(t){e.call(o,t)}function n(e){e.resItem.url==t&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,n,null),i.call(o))}var s=this;"undefined"!=typeof generateEUI?egret.callLater(function(){e.call(o,generateEUI)},this):"undefined"!=typeof generateEUI2?RES.getResByUrl("resource/gameEui.json",function(t,i){window.JSONParseClass.setData(t),egret.callLater(function(){e.call(o,generateEUI2)},s)},this,RES.ResourceItem.TYPE_JSON):(RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,n,null),RES.getResByUrl(t,r,this,RES.ResourceItem.TYPE_TEXT))},t}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var BackgroundGame=function(t){function e(){var e=t.call(this)||this;return e.mBgSpeed=4e3,e.addEventListener(egret.Event.ADDED_TO_STAGE,e.loadBackground,e),e}return __extends(e,t),e.prototype.loadBackground=function(){this.mBackgroundTop=ImageResUtils.createBitmapByName("background_jpg"),this.addChild(this.mBackgroundTop);var t=this.stage.stageWidth;this.stageH=this.stage.stageHeight,this.mBackgroundTop.width=t,this.mBackgroundTop.height=this.stageH,this.mBackgroundTop.y=-this.stageH,this.mBackgroundBottom=ImageResUtils.createBitmapByName("background_jpg"),this.mBackgroundBottom.width=t,this.mBackgroundBottom.height=this.stageH,this.addChild(this.mBackgroundBottom)},e.prototype.startAnimationBg=function(){egret.Tween.get(this.mBackgroundTop,{loop:!0}).to({y:0},this.mBgSpeed),egret.Tween.get(this.mBackgroundBottom,{loop:!0}).to({y:this.stageH},this.mBgSpeed)},e}(egret.DisplayObjectContainer);__reflect(BackgroundGame.prototype,"BackgroundGame");var LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.createView(),e}return __extends(e,t),e.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},e.prototype.onProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var TheFirstPass=function(t){function e(e){return t.call(this,e)||this}return __extends(e,t),e.prototype.startGame=function(){t.prototype.startGame.call(this),this.mBgGame=new BackgroundGame,this.addChild(this.mBgGame);var e=new Lead(function(){this.mBgGame.startAnimationBg()},this);this.addChild(e),this.mBgSoundMusic=new BgSoundMusic,this.mBgSoundMusic.playMusic(),this.mGameTextMessage=new egret.TextField,this.mGameTextMessage.textColor=268435455,this.mGameTextMessage.size=40,this.mGameTextMessage.textAlign="center",this.mGameTextMessage.x=0,this.mGameRestart=new egret.TextField,this.mGameRestart.textColor=268435455,this.mGameRestart.size=40,this.mGameRestart.textAlign=egret.HorizontalAlign.CENTER,this.mGameRestart.verticalAlign=egret.VerticalAlign.MIDDLE,this.mGameRestart.backgroundColor=0,this.mGameRestart.text="再来一次",this.mGameRestart.touchEnabled=!0,this.mGameRestart.stroke=1,this.mGameRestart.strokeColor=16777215},e.prototype.endGame=function(){t.prototype.endGame.call(this),this.mBgSoundMusic.stopMusic(),this.addChild(this.mBgGame),this.mBgGame.loadBackground(),this.mGameTextMessage.text="游戏结束，你输了！",this.addChild(this.mGameTextMessage),this.addChild(this.mGameRestart),this.mGameRestart.addEventListener(egret.TouchEvent.TOUCH_TAP,this.restartGame,this)},e.prototype.restartGame=function(){this.mGameRestart.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.restartGame,this),t.prototype.endGame.call(this),this.startGame()},e}(Level);__reflect(TheFirstPass.prototype,"TheFirstPass");var Lead=function(t){function e(e,i){var o=t.call(this)||this;return o.mScoreNumber=0,o.mTouchStatus=!1,o.mDistance=new egret.Point,o.mTweenComplete=e,o.mLevel=i,o}return __extends(e,t),e.prototype.createAirplane=function(){var e=this;t.prototype.createAirplane.call(this),this.setBlood(100),this.mSpeedAngle=5;var i=this.getStageW(),o=this.getStageH();this.mLead=ImageResUtils.createBitmapByName("lead_png"),this.addChild(this.mLead),this.mLead.width=68,this.mLead.height=68,this.mLead.x=i/2,this.mLead.y=o+2*this.mLead.height,this.mPlayblow=ImageResUtils.createBitmapByName("playblow_png"),this.addChildAt(this.mPlayblow,0),this.mPlayblowH=65,this.mPlayblow.width=68,this.mPlayblow.height=this.mPlayblowH,this.mPlayblow.x=this.mLead.x,this.mPlayblow.y=this.mLead.y+this.mLead.height/1.5;var r=new egret.Timer(5,0);r.addEventListener(egret.TimerEvent.TIMER,this.startBlowAnimation,this),r.start(),this.mCollect=ImageResUtils.createBitmapByName("playerunmatched_png"),this.addChild(this.mCollect),this.mCollect.width=68,this.mCollect.height=68,this.mCollect.anchorOffsetX=this.mCollect.width/2,this.mCollect.anchorOffsetY=this.mCollect.height/2,this.mCollect.x=this.mLead.x+this.mCollect.width/2,this.mCollect.y=this.mPlayblow.y+1.2*this.mPlayblow.height,this.addEventListener(egret.Event.ENTER_FRAME,function(t){e.mCollect.rotation+=10},this);var n=o-3*this.mLead.height;egret.Tween.get(this.mLead).to({y:n},2500,egret.Ease.backInOut).call(this.mTweenComplete,this.mLevel);var s=n+this.mLead.height/1.5;egret.Tween.get(this.mPlayblow).to({y:s},2500,egret.Ease.backInOut),egret.Tween.get(this.mCollect).to({y:s+1.2*this.mPlayblow.height},2500,egret.Ease.backInOut),this.mCollect.touchEnabled=!0,this.mCollect.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.mouseDown,this),this.mCollect.addEventListener(egret.TouchEvent.TOUCH_END,this.mouseUp,this),this.mBloodShape=new egret.Shape,this.addChild(this.mBloodShape),this.updateBlood(),this.mScore=new egret.TextField,this.mScore.textColor=268435455,this.mScore.width=200,this.mScore.height=100,this.mScore.textAlign="center",this.mScore.x=0,this.mScore.y=30,this.addChild(this.mScore),this.updateScore()},e.prototype.updateBlood=function(){this.mBloodShape.graphics.clear();var t=this.getBlood();0==t&&(Level.GAME_STATE=Level.GAME_END),t>100&&(t=100),20>=t?this.mBloodShape.graphics.beginFill(14423100):this.mBloodShape.graphics.beginFill(268435455),this.mBloodShape.graphics.drawRect(240,40,4*t,10),this.mBloodShape.graphics.endFill()},e.prototype.updateScore=function(){this.mScore.text=this.mScoreNumber.toString()},e.prototype.mouseDown=function(t){this.mTouchStatus=!0,this.mDistance.x=t.stageX-this.mLead.x,this.mDistance.y=t.stageY-this.mLead.y,this.stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.mouseMove,this)},e.prototype.mouseMove=function(t){if(this.mTouchStatus&&this.getBlood()>0){var e=t.stageX-this.mDistance.x,i=t.stageY-this.mDistance.y;e=0>e?0:e,e=e>this.getStageW()-this.mLead.width?this.getStageW()-this.mLead.width:e,i=0>i?0:i,i=i>this.getStageH()-this.mLead.height-this.mCollect.height?this.getStageH()-this.mLead.height-this.mCollect.height:i,this.mLead.x=e,this.mLead.y=i,this.mPlayblow.x=this.mLead.x,this.mPlayblow.y=this.mLead.y+this.mLead.height/1.5,this.mCollect.x=this.mLead.x+this.mCollect.width/2,this.mCollect.y=this.mPlayblow.y+1.2*this.mPlayblow.height,this.mCollect.alpha=0}},e.prototype.mouseUp=function(t){this.mTouchStatus=!1,this.stage.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.mouseMove,this),this.mCollect.alpha=1},e.prototype.startBlowAnimation=function(){this.mPlayblowH+=this.mSpeedAngle,(this.mPlayblowH>=75||this.mPlayblowH<55)&&(this.mSpeedAngle=-this.mSpeedAngle),this.mPlayblow.height=this.mPlayblowH},e.prototype.getX=function(){return this.mLead.x},e.prototype.getY=function(){return this.mLead.y},e.prototype.getWidth=function(){return this.mLead.width},e.prototype.getHeight=function(){return this.mLead.height},e}(Role);__reflect(Lead.prototype,"Lead");var AssetAdapter=function(){function t(){}return t.prototype.getAsset=function(t,e,i){function o(o){e.call(i,o,t)}if(RES.hasRes(t)){var r=RES.getRes(t);r?o(r):RES.getResAsync(t,o,this)}else RES.getResByUrl(t,o,this,RES.ResourceItem.TYPE_IMAGE)},t}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var BgSoundMusic=function(){function t(){}return t.prototype.playMusic=function(){var t=new egret.Sound,e="resource/assets/gamemusic.mp3";t.addEventListener(egret.Event.COMPLETE,this.onLoadComplete,this),t.load(e)},t.prototype.onLoadComplete=function(t){var e=t.target;this.mSoundChannel=e.play(0,0)},t.prototype.stopMusic=function(){this.mSoundChannel&&(this.mSoundChannel.stop(),this.mSoundChannel=null)},t}();__reflect(BgSoundMusic.prototype,"BgSoundMusic");var ImageResUtils=function(){function t(){}return t.createBitmapByName=function(t){var e=new egret.Bitmap,i=RES.getRes(t);return e.texture=i,e},t}();__reflect(ImageResUtils.prototype,"ImageResUtils");